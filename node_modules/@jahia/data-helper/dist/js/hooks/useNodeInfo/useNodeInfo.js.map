{"version":3,"names":["_react","require","_client","_useNodeInfo","_getPermissionFragment","_getIsNodeTypeFragment","_useSchemaFields","_useNodeInfo2","_useMemoRequest3","_fastDeepEqual","_interopRequireDefault","_excluded","ownKeys","object","enumerableOnly","keys","Object","getOwnPropertySymbols","symbols","filter","sym","getOwnPropertyDescriptor","enumerable","push","apply","_objectSpread","target","i","arguments","length","source","forEach","key","_defineProperty2","getOwnPropertyDescriptors","defineProperties","defineProperty","queue","schemaResult","timeout","observedQueries","scheduleQueue","client","window","setTimeout","timeoutHandler","clearTimeout","mergedQueue","request","toInsert","variables","queryOptions","options","originals","mergeable","find","q","JSON","stringify","isSubset","merge","obs","unsubscribe","mergedRequest","_getQuery","getQuery","query","generatedVariables","skip","setResult","loading","watchedQuery","watchQuery","errorPolicy","subscribe","_ref","data","others","_objectWithoutProperties2","result","getResult","deepEquals","refetch","refetchQueries","include","useNodeInfo","_useState","useState","_useState2","_slicedToArray2","useApolloClient","SCHEMA_FIELDS_QUERY","type","then","_ref2","_useMemoRequest","useMemoRequest","_useMemoRequest2","currentRequest","queryHasChanged","useEffect","splice","indexOf","fetchPolicy","infoQuery","res","readQuery","exports","node","jcr","nodeByPath","nodeById","nodes","nodesByPath","nodesById","decodeResult","map","n","nodeOrig","site","getPermissions","name","getEncodedPermissionName","getSitePermissions","getIsNodeTypes","getEncodedNodeTypeName","getMimeType","resourceChildren","mimeType","value"],"sources":["useNodeInfo.ts"],"sourcesContent":["import {useEffect, useState} from 'react';\nimport {ApolloClient, ApolloError, NetworkStatus, useApolloClient, WatchQueryOptions} from '@apollo/client';\nimport {getQuery, NodeInfoOptions} from './useNodeInfo.gql-queries';\nimport {getEncodedPermissionName} from '../../fragments/getPermissionFragment';\nimport {getEncodedNodeTypeName} from '../../fragments/getIsNodeTypeFragment';\nimport {SCHEMA_FIELDS_QUERY} from '../useSchemaFields/useSchemaFields.gql-queries';\nimport {isSubset, merge} from './useNodeInfo.utils';\nimport {useMemoRequest} from './useMemoRequest';\nimport deepEquals from 'fast-deep-equal';\nimport {DocumentNode, GraphQLError} from 'graphql';\n\nexport type Request = {\n    variables:{[key:string]: any},\n    options: NodeInfoOptions,\n    queryOptions: Partial<WatchQueryOptions>,\n}\n\nexport type QueuedRequest = Request & {\n    result?: any,\n    setResult: (data: any) => void\n}\n\nexport type MergedRequest = Request & { originals: QueuedRequest[] };\n\nexport type NodeInfoResult = {\n    node?: any,\n    nodes?: any[],\n    errors?: readonly GraphQLError[],\n    error?: ApolloError,\n    loading?: boolean,\n    networkStatus?: NetworkStatus,\n    partial?: boolean,\n    query?: DocumentNode,\n    variables?: {[key:string]: any}\n}\n\nconst queue: QueuedRequest[] = [];\nlet schemaResult: any;\nlet timeout: number;\nlet observedQueries: { unsubscribe: () => void }[] = [];\n\nfunction scheduleQueue(client: ApolloClient<object>) {\n    if (!timeout && schemaResult) {\n        timeout = window.setTimeout(() => {\n            timeoutHandler(client);\n            clearTimeout(timeout);\n            timeout = null;\n        }, 0);\n    }\n}\n\nconst timeoutHandler = (client: ApolloClient<object>) => {\n    const mergedQueue: MergedRequest[] = [];\n\n    queue.forEach(request => {\n        const toInsert = {\n            variables: request.variables,\n            queryOptions: request.queryOptions,\n            options: request.options,\n            originals: [request]\n        };\n\n        const mergeable = mergedQueue.find(q => JSON.stringify(q.queryOptions) === JSON.stringify(toInsert.queryOptions) && (isSubset(q.variables, toInsert.variables) || isSubset(toInsert.variables, q.variables)));\n\n        if (mergeable) {\n            merge(mergeable, toInsert);\n        } else {\n            mergedQueue.push({\n                variables: toInsert.variables && {...toInsert.variables},\n                queryOptions: toInsert.queryOptions && {...toInsert.queryOptions},\n                options: toInsert.options && {...toInsert.options},\n                originals: toInsert.originals\n            });\n        }\n    });\n\n    observedQueries.forEach(obs => obs.unsubscribe());\n    observedQueries = [];\n\n    mergedQueue.forEach(mergedRequest => {\n        const {variables, queryOptions, options, originals} = mergedRequest;\n        const {query, generatedVariables, skip} = getQuery(variables, schemaResult, options);\n        if (skip) {\n            // No query to execute\n            originals.forEach(request => {\n                request.setResult({\n                    loading: false\n                });\n            });\n        } else {\n            const watchedQuery = client.watchQuery({query, errorPolicy: 'ignore', ...queryOptions, variables: generatedVariables}).subscribe(({data, ...others}) => {\n                const result = getResult(data, others, options, query, generatedVariables);\n\n                originals.forEach(request => {\n                    if (!deepEquals(request.result, result)) {\n                        request.result = result;\n                        request.setResult({\n                            ...result,\n                            refetch() {\n                                client.refetchQueries({include: [query]});\n                            }\n                        });\n                    }\n                });\n            });\n            observedQueries.push(watchedQuery);\n        }\n    });\n};\n\nexport const useNodeInfo = (variables: {[key:string]: unknown}, options?: NodeInfoOptions, queryOptions?: Partial<WatchQueryOptions>) => {\n    const [result, setResult] = useState<NodeInfoResult>({\n        loading: true\n    });\n\n    const client = useApolloClient();\n\n    if (!schemaResult) {\n        client.query({query: SCHEMA_FIELDS_QUERY, variables: {type: 'GqlPublicationInfo'}}).then(({data}: {data: any}) => {\n            schemaResult = data;\n            scheduleQueue(client);\n        });\n    }\n\n    // Normalize and memoize request\n    const [currentRequest, queryHasChanged] = useMemoRequest(variables, queryOptions, options, setResult);\n    useEffect(() => {\n        queue.push(currentRequest);\n        scheduleQueue(client);\n\n        return () => {\n            queue.splice(queue.indexOf(currentRequest), 1);\n        };\n    }, [client, currentRequest]);\n\n    if (queryHasChanged && !result.loading) {\n        if (queryOptions?.fetchPolicy !== 'no-cache' && queryOptions?.fetchPolicy !== 'network-only') {\n            const infoQuery = getQuery(currentRequest.variables, schemaResult, currentRequest.options);\n            const res = client.readQuery({query: infoQuery.query, variables: infoQuery.generatedVariables});\n            if (res) {\n                const result = getResult(res, {}, currentRequest.options, infoQuery.query, infoQuery.generatedVariables);\n                setResult(result);\n                return result;\n            }\n        }\n\n        setResult({\n            loading: true\n        });\n        return {loading: true};\n    }\n\n    return result;\n};\n\nconst getResult = (data: any, others: NodeInfoResult, options: NodeInfoOptions, query: DocumentNode, generatedVariables: {[key:string]: unknown}) => {\n    const node: object = (data && data.jcr && (data.jcr.nodeByPath || data.jcr.nodeById)) || null;\n    const nodes: object[] = (data && data.jcr && (data.jcr.nodesByPath || data.jcr.nodesById)) || null;\n    let result = others;\n\n    if (node) {\n        result = {\n            node: decodeResult(node, options),\n            ...others,\n            query,\n            variables: generatedVariables\n        };\n    }\n\n    if (nodes) {\n        result = {\n            nodes: nodes.map(n => decodeResult(n, options)),\n            ...others,\n            query,\n            variables: generatedVariables\n        };\n    }\n\n    return result;\n};\n\nconst decodeResult = (nodeOrig: any, options: NodeInfoOptions) => {\n    const node = {...nodeOrig};\n    if (node.site) {\n        node.site = {...node.site};\n    }\n\n    if (node && options) {\n        if (options.getPermissions) {\n            options.getPermissions.forEach(name => {\n                const res = node[getEncodedPermissionName(name)];\n                delete node[getEncodedPermissionName(name)];\n                node[name] = res;\n            });\n        }\n\n        if (options.getSitePermissions) {\n            options.getSitePermissions.forEach(name => {\n                const res = node.site[getEncodedPermissionName(name)];\n                delete node.site[getEncodedPermissionName(name)];\n                node.site[name] = res;\n            });\n        }\n\n        if (options.getIsNodeTypes) {\n            options.getIsNodeTypes.forEach(name => {\n                const res = node[getEncodedNodeTypeName(name)];\n                delete node[getEncodedNodeTypeName(name)];\n                node[name] = res;\n            });\n        }\n\n        if (options.getMimeType) {\n            const {nodes} = node.resourceChildren;\n            node.mimeType = (nodes.length !== 0 && nodes[0].mimeType.value) || null;\n            delete node.resourceChildren;\n        }\n    }\n\n    return node;\n};\n"],"mappings":"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"}