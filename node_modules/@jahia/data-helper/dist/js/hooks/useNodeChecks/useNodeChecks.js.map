{"version":3,"names":["_useNodeInfo2","require","_excluded","_excluded2","ownKeys","object","enumerableOnly","keys","Object","getOwnPropertySymbols","symbols","filter","sym","getOwnPropertyDescriptor","enumerable","push","apply","_objectSpread","target","i","arguments","length","source","forEach","key","_defineProperty2","getOwnPropertyDescriptors","defineProperties","defineProperty","evaluateVisibilityPaths","visible","visibilityPaths","nodePath","RegExp","test","addArrayOptionValues","newValue","useNodeInfoOptions","useNodeInfoKey","concat","item","indexOf","useNodeChecks","variables","options","queryOptions","requiredPermission","requiredSitePermission","showOnNodeTypes","hideOnNodeTypes","requireModuleInstalledOnSite","showForPaths","hideForPaths","othersOptions","_objectWithoutProperties2","requiredPermissions","requiredSitePermissions","getSiteInstalledModules","_useNodeInfo","useNodeInfo","node","nodes","loading","othersResults","checksResult","doNodeCheck","currentNode","reduce","acc","val","site","installedModulesWithAllDependencies","includes","path","result","exports"],"sources":["useNodeChecks.ts"],"sourcesContent":["import {NodeInfoResult, useNodeInfo} from '../useNodeInfo';\nimport {NodeInfoOptions} from '~/hooks/useNodeInfo/useNodeInfo.gql-queries';\nimport {WatchQueryOptions} from '@apollo/client';\n\nexport type NodeCheckOptions = NodeInfoOptions & Partial<{\n    requiredPermission: string | string[],\n    requiredSitePermission: string | string[],\n    showOnNodeTypes: string[],\n    hideOnNodeTypes: string[],\n    requireModuleInstalledOnSite: string[],\n    showForPaths: string[],\n    hideForPaths: string[],\n}>\n\nexport type NodeCheckResult = NodeInfoResult & Partial<{\n    checksResult: boolean,\n}>\n\nconst evaluateVisibilityPaths = (visible: boolean, visibilityPaths: string[], nodePath: string) => {\n    for (let i = 0; i < visibilityPaths.length; i++) {\n        if (new RegExp(visibilityPaths[i]).test(nodePath)) {\n            return visible;\n        }\n    }\n\n    return !visible;\n};\n\nfunction addArrayOptionValues(newValue: string[], useNodeInfoOptions: NodeInfoOptions, useNodeInfoKey: 'getPermissions' | 'getSitePermissions' |'getIsNodeTypes'| 'getProperties') {\n    if (newValue) {\n        useNodeInfoOptions[useNodeInfoKey] = useNodeInfoOptions[useNodeInfoKey] || [];\n        useNodeInfoOptions[useNodeInfoKey] = useNodeInfoOptions[useNodeInfoKey].concat(newValue.filter(item => useNodeInfoOptions[useNodeInfoKey].indexOf(item) < 0));\n    }\n}\n\nexport const useNodeChecks = (variables: {[key:string]: any}, options: NodeCheckOptions, queryOptions: WatchQueryOptions): NodeCheckResult => {\n    const {requiredPermission, requiredSitePermission, showOnNodeTypes, hideOnNodeTypes, requireModuleInstalledOnSite, showForPaths, hideForPaths, ...othersOptions} = options;\n    const useNodeInfoOptions = {...othersOptions};\n\n    const requiredPermissions = (typeof requiredPermission === 'string') ? [requiredPermission] : requiredPermission;\n    const requiredSitePermissions = (typeof requiredSitePermission === 'string') ? [requiredSitePermission] : requiredSitePermission;\n\n    addArrayOptionValues(requiredPermissions, useNodeInfoOptions, 'getPermissions');\n    addArrayOptionValues(requiredSitePermissions, useNodeInfoOptions, 'getSitePermissions');\n    addArrayOptionValues(showOnNodeTypes, useNodeInfoOptions, 'getIsNodeTypes');\n    addArrayOptionValues(hideOnNodeTypes, useNodeInfoOptions, 'getIsNodeTypes');\n\n    if (requireModuleInstalledOnSite) {\n        useNodeInfoOptions.getSiteInstalledModules = true;\n    }\n\n    const {node, nodes, loading, ...othersResults} = useNodeInfo(variables, useNodeInfoOptions, queryOptions);\n\n    if (loading) {\n        return {loading, ...othersResults};\n    }\n\n    if (!node && !nodes) {\n        return {checksResult: false, loading, ...othersResults};\n    }\n\n    const doNodeCheck = (currentNode: any) =>\n        (!requiredPermissions || requiredPermissions.reduce((acc, val) => acc || currentNode[val], false)) &&\n        (!requiredSitePermissions || requiredSitePermissions.reduce((acc, val) => acc || currentNode.site[val], false)) &&\n        (!showOnNodeTypes || showOnNodeTypes.reduce((acc, val) => acc || currentNode[val], false)) &&\n        (!hideOnNodeTypes || !hideOnNodeTypes.reduce((acc, val) => acc || currentNode[val], false)) &&\n        (!requireModuleInstalledOnSite || requireModuleInstalledOnSite.reduce((acc, val) => acc && currentNode.site.installedModulesWithAllDependencies.includes(val), true)) &&\n        (!hideForPaths || evaluateVisibilityPaths(false, hideForPaths, currentNode.path || variables.path)) &&\n        (!showForPaths || evaluateVisibilityPaths(true, showForPaths, currentNode.path || variables.path));\n\n    const result = node ? doNodeCheck(node) : nodes.reduce((acc, val) => acc && doNodeCheck(val), true);\n\n    return {node, nodes, checksResult: result, loading, ...othersResults};\n};\n"],"mappings":";;;;;;;;;AAAA,IAAAA,aAAA,GAAAC,OAAA;AAA2D,IAAAC,SAAA;EAAAC,UAAA;AAAA,SAAAC,QAAAC,MAAA,EAAAC,cAAA,QAAAC,IAAA,GAAAC,MAAA,CAAAD,IAAA,CAAAF,MAAA,OAAAG,MAAA,CAAAC,qBAAA,QAAAC,OAAA,GAAAF,MAAA,CAAAC,qBAAA,CAAAJ,MAAA,GAAAC,cAAA,KAAAI,OAAA,GAAAA,OAAA,CAAAC,MAAA,WAAAC,GAAA,WAAAJ,MAAA,CAAAK,wBAAA,CAAAR,MAAA,EAAAO,GAAA,EAAAE,UAAA,OAAAP,IAAA,CAAAQ,IAAA,CAAAC,KAAA,CAAAT,IAAA,EAAAG,OAAA,YAAAH,IAAA;AAAA,SAAAU,cAAAC,MAAA,aAAAC,CAAA,MAAAA,CAAA,GAAAC,SAAA,CAAAC,MAAA,EAAAF,CAAA,UAAAG,MAAA,WAAAF,SAAA,CAAAD,CAAA,IAAAC,SAAA,CAAAD,CAAA,QAAAA,CAAA,OAAAf,OAAA,CAAAI,MAAA,CAAAc,MAAA,OAAAC,OAAA,WAAAC,GAAA,QAAAC,gBAAA,aAAAP,MAAA,EAAAM,GAAA,EAAAF,MAAA,CAAAE,GAAA,SAAAhB,MAAA,CAAAkB,yBAAA,GAAAlB,MAAA,CAAAmB,gBAAA,CAAAT,MAAA,EAAAV,MAAA,CAAAkB,yBAAA,CAAAJ,MAAA,KAAAlB,OAAA,CAAAI,MAAA,CAAAc,MAAA,GAAAC,OAAA,WAAAC,GAAA,IAAAhB,MAAA,CAAAoB,cAAA,CAAAV,MAAA,EAAAM,GAAA,EAAAhB,MAAA,CAAAK,wBAAA,CAAAS,MAAA,EAAAE,GAAA,iBAAAN,MAAA;AAkB3D,IAAMW,uBAAuB,GAAG,SAA1BA,uBAAuBA,CAAIC,OAAgB,EAAEC,eAAyB,EAAEC,QAAgB,EAAK;EAC/F,KAAK,IAAIb,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAGY,eAAe,CAACV,MAAM,EAAEF,CAAC,EAAE,EAAE;IAC7C,IAAI,IAAIc,MAAM,CAACF,eAAe,CAACZ,CAAC,CAAC,CAAC,CAACe,IAAI,CAACF,QAAQ,CAAC,EAAE;MAC/C,OAAOF,OAAO;IAClB;EACJ;EAEA,OAAO,CAACA,OAAO;AACnB,CAAC;AAED,SAASK,oBAAoBA,CAACC,QAAkB,EAAEC,kBAAmC,EAAEC,cAA0F,EAAE;EAC/K,IAAIF,QAAQ,EAAE;IACVC,kBAAkB,CAACC,cAAc,CAAC,GAAGD,kBAAkB,CAACC,cAAc,CAAC,IAAI,EAAE;IAC7ED,kBAAkB,CAACC,cAAc,CAAC,GAAGD,kBAAkB,CAACC,cAAc,CAAC,CAACC,MAAM,CAACH,QAAQ,CAACzB,MAAM,CAAC,UAAA6B,IAAI;MAAA,OAAIH,kBAAkB,CAACC,cAAc,CAAC,CAACG,OAAO,CAACD,IAAI,CAAC,GAAG,CAAC;IAAA,EAAC,CAAC;EACjK;AACJ;AAEO,IAAME,aAAa,GAAG,SAAhBA,aAAaA,CAAIC,SAA8B,EAAEC,OAAyB,EAAEC,YAA+B,EAAsB;EAC1I,IAAOC,kBAAkB,GAA0IF,OAAO,CAAnKE,kBAAkB;IAAEC,sBAAsB,GAAkHH,OAAO,CAA/IG,sBAAsB;IAAEC,eAAe,GAAiGJ,OAAO,CAAvHI,eAAe;IAAEC,eAAe,GAAgFL,OAAO,CAAtGK,eAAe;IAAEC,4BAA4B,GAAkDN,OAAO,CAArFM,4BAA4B;IAAEC,YAAY,GAAoCP,OAAO,CAAvDO,YAAY;IAAEC,YAAY,GAAsBR,OAAO,CAAzCQ,YAAY;IAAKC,aAAa,OAAAC,yBAAA,aAAIV,OAAO,EAAA1C,SAAA;EAC1K,IAAMmC,kBAAkB,GAAApB,aAAA,KAAOoC,aAAa,CAAC;EAE7C,IAAME,mBAAmB,GAAI,OAAOT,kBAAkB,KAAK,QAAQ,GAAI,CAACA,kBAAkB,CAAC,GAAGA,kBAAkB;EAChH,IAAMU,uBAAuB,GAAI,OAAOT,sBAAsB,KAAK,QAAQ,GAAI,CAACA,sBAAsB,CAAC,GAAGA,sBAAsB;EAEhIZ,oBAAoB,CAACoB,mBAAmB,EAAElB,kBAAkB,EAAE,gBAAgB,CAAC;EAC/EF,oBAAoB,CAACqB,uBAAuB,EAAEnB,kBAAkB,EAAE,oBAAoB,CAAC;EACvFF,oBAAoB,CAACa,eAAe,EAAEX,kBAAkB,EAAE,gBAAgB,CAAC;EAC3EF,oBAAoB,CAACc,eAAe,EAAEZ,kBAAkB,EAAE,gBAAgB,CAAC;EAE3E,IAAIa,4BAA4B,EAAE;IAC9Bb,kBAAkB,CAACoB,uBAAuB,GAAG,IAAI;EACrD;EAEA,IAAAC,YAAA,GAAiD,IAAAC,yBAAW,EAAChB,SAAS,EAAEN,kBAAkB,EAAEQ,YAAY,CAAC;IAAlGe,IAAI,GAAAF,YAAA,CAAJE,IAAI;IAAEC,KAAK,GAAAH,YAAA,CAALG,KAAK;IAAEC,OAAO,GAAAJ,YAAA,CAAPI,OAAO;IAAKC,aAAa,OAAAT,yBAAA,aAAAI,YAAA,EAAAvD,UAAA;EAE7C,IAAI2D,OAAO,EAAE;IACT,OAAA7C,aAAA;MAAQ6C,OAAO,EAAPA;IAAO,GAAKC,aAAa;EACrC;EAEA,IAAI,CAACH,IAAI,IAAI,CAACC,KAAK,EAAE;IACjB,OAAA5C,aAAA;MAAQ+C,YAAY,EAAE,KAAK;MAAEF,OAAO,EAAPA;IAAO,GAAKC,aAAa;EAC1D;EAEA,IAAME,WAAW,GAAG,SAAdA,WAAWA,CAAIC,WAAgB;IAAA,OACjC,CAAC,CAACX,mBAAmB,IAAIA,mBAAmB,CAACY,MAAM,CAAC,UAACC,GAAG,EAAEC,GAAG;MAAA,OAAKD,GAAG,IAAIF,WAAW,CAACG,GAAG,CAAC;IAAA,GAAE,KAAK,CAAC,MAChG,CAACb,uBAAuB,IAAIA,uBAAuB,CAACW,MAAM,CAAC,UAACC,GAAG,EAAEC,GAAG;MAAA,OAAKD,GAAG,IAAIF,WAAW,CAACI,IAAI,CAACD,GAAG,CAAC;IAAA,GAAE,KAAK,CAAC,CAAC,KAC9G,CAACrB,eAAe,IAAIA,eAAe,CAACmB,MAAM,CAAC,UAACC,GAAG,EAAEC,GAAG;MAAA,OAAKD,GAAG,IAAIF,WAAW,CAACG,GAAG,CAAC;IAAA,GAAE,KAAK,CAAC,CAAC,KACzF,CAACpB,eAAe,IAAI,CAACA,eAAe,CAACkB,MAAM,CAAC,UAACC,GAAG,EAAEC,GAAG;MAAA,OAAKD,GAAG,IAAIF,WAAW,CAACG,GAAG,CAAC;IAAA,GAAE,KAAK,CAAC,CAAC,KAC1F,CAACnB,4BAA4B,IAAIA,4BAA4B,CAACiB,MAAM,CAAC,UAACC,GAAG,EAAEC,GAAG;MAAA,OAAKD,GAAG,IAAIF,WAAW,CAACI,IAAI,CAACC,mCAAmC,CAACC,QAAQ,CAACH,GAAG,CAAC;IAAA,GAAE,IAAI,CAAC,CAAC,KACpK,CAACjB,YAAY,IAAIvB,uBAAuB,CAAC,KAAK,EAAEuB,YAAY,EAAEc,WAAW,CAACO,IAAI,IAAI9B,SAAS,CAAC8B,IAAI,CAAC,CAAC,KAClG,CAACtB,YAAY,IAAItB,uBAAuB,CAAC,IAAI,EAAEsB,YAAY,EAAEe,WAAW,CAACO,IAAI,IAAI9B,SAAS,CAAC8B,IAAI,CAAC,CAAC;EAAA;EAEtG,IAAMC,MAAM,GAAGd,IAAI,GAAGK,WAAW,CAACL,IAAI,CAAC,GAAGC,KAAK,CAACM,MAAM,CAAC,UAACC,GAAG,EAAEC,GAAG;IAAA,OAAKD,GAAG,IAAIH,WAAW,CAACI,GAAG,CAAC;EAAA,GAAE,IAAI,CAAC;EAEnG,OAAApD,aAAA;IAAQ2C,IAAI,EAAJA,IAAI;IAAEC,KAAK,EAALA,KAAK;IAAEG,YAAY,EAAEU,MAAM;IAAEZ,OAAO,EAAPA;EAAO,GAAKC,aAAa;AACxE,CAAC;AAACY,OAAA,CAAAjC,aAAA,GAAAA,aAAA"}