{"version":3,"names":["useQuery","replaceFragmentsInDocument","TREE_QUERY","useTreeEntries","_ref","queryOptions","fragments","rootPaths","openPaths","selectedPaths","openableTypes","selectableTypes","recursionTypesFilter","queryVariables","hideRoot","sortBy","query","getTreeEntries","data","treeEntries","nodesById","jcr","addNode","node","depth","index","selected","selectable","indexOf","path","treeEntry","name","open","openable","prefix","repeat","hidden","hasChildren","children","pageInfo","nodesCount","splice","uuid","rootNodes","forEach","rootNode","root","openNodes","_toConsumableArray","sort","a","b","localeCompare","parent","parentIndex","nodes","reverse","child","filter","treeNode","vars","_objectSpread","types","Array","from","Set","concat","multi","_useQuery","variables","others","_objectWithoutProperties","_excluded"],"sources":["useTreeEntries.ts"],"sourcesContent":["import {QueryHookOptions, useQuery} from '@apollo/client';\nimport {replaceFragmentsInDocument} from '../../fragments/fragments.utils';\nimport {TREE_QUERY} from './useTreeEntries.gql-queries';\nimport {Fragment} from '~/fragments';\n\nexport type UseTreeEntriesArgs = Partial<{\n    fragments: (string|Fragment)[],\n    rootPaths: string[],\n    openPaths: string[],\n    selectedPaths: string[],\n    openableTypes: string[],\n    selectableTypes: string[],\n    recursionTypesFilter: object,\n    queryVariables: {[key:string]: any},\n    hideRoot: boolean,\n    sortBy: string,\n}>\n\nexport const useTreeEntries = ({\n    fragments,\n    rootPaths,\n    openPaths,\n    selectedPaths,\n    openableTypes,\n    selectableTypes,\n    recursionTypesFilter,\n    queryVariables,\n    hideRoot,\n    sortBy\n}: UseTreeEntriesArgs, queryOptions: QueryHookOptions) => {\n    const query = replaceFragmentsInDocument(TREE_QUERY, fragments);\n\n    const getTreeEntries = (data: any) => {\n        const treeEntries: any[] = [];\n        const nodesById: {[key:string]: any} = {};\n        const jcr: any = data ? data.jcr : {};\n\n        const addNode = function (node: any, depth: number, index: number) {\n            let selected = false;\n            if (node.selectable) {\n                selected = selectedPaths.indexOf(node.path) !== -1;\n            }\n\n            const treeEntry = {\n                name: node.name,\n                path: node.path,\n                open: node.openable && openPaths.indexOf(node.path) !== -1,\n                selected,\n                openable: node.openable,\n                selectable: node.selectable,\n                depth,\n                prefix: '&nbsp;'.repeat(depth * 3),\n                node,\n                hidden: false,\n                hasChildren: node.children.pageInfo.nodesCount > 0\n            };\n            treeEntries.splice(index, 0, treeEntry);\n            nodesById[node.uuid] = treeEntry;\n            return treeEntry;\n        };\n\n        if (jcr) {\n            if (jcr.rootNodes) {\n                jcr.rootNodes.forEach((rootNode: any) => {\n                    const root = addNode(rootNode, 0, 0);\n                    root.hidden = hideRoot;\n                });\n            }\n\n            if (jcr.openNodes) {\n                [...jcr.openNodes].sort((a, b) => a.path.localeCompare(b.path)).forEach(node => {\n                    const parent = nodesById[node.uuid];\n                    if (parent) {\n                        const parentIndex = treeEntries.indexOf(parent);\n                        [...node.children.nodes].reverse().forEach(child => {\n                            addNode(child, parent.depth + 1, parentIndex + 1);\n                        });\n                    }\n                });\n            }\n        }\n\n        return treeEntries.filter(treeNode => !treeNode.hidden);\n    };\n\n    const vars = {\n        rootPaths,\n        types: Array.from(new Set([...(openableTypes || []), ...(selectableTypes || [])])),\n        recursionTypesFilter: recursionTypesFilter || {types: 'nt:base', multi: 'NONE'},\n        selectable: selectableTypes,\n        openable: openableTypes,\n        openPaths,\n        sortBy,\n        ...queryVariables\n    };\n\n    const {data, ...others} = useQuery(query, {...queryOptions, variables: vars});\n    return {treeEntries: getTreeEntries(data), ...others};\n};\n"],"mappings":"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"}